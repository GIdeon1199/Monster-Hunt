<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Nicholson Conspiracy â€“ Level 3 (The Gallery)</title>
  <style>
    * { margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
    #panorama { width: 100%; height: 100%; }

    #timer {
      position: fixed; top: 15px; left: 75px; color: #ff00ff; font-size: 1.4em; font-weight: bold;
      background: rgba(0,0,0,0.85); padding: 10px 18px; border-radius: 12px; z-index: 110;
      font-family: 'Courier New', monospace; border: 2px solid #6600cc; box-shadow: 0 0 10px rgba(255,0,255,0.3);
    }

    #counter {
      position: fixed; top: 15px; right: 15px; color: white;
      background: rgba(0,0,0,0.8); padding: 10px 16px; border-radius: 10px;
      font-size: 1.1em; z-index: 110; display: flex; align-items: center; gap: 8px;
      border: 2px solid #6600cc;
    }
    #counter img { width: 24px; height: 24px; filter: brightness(0) invert(1); }

    #monster-bar {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 100px;
      background: rgba(10,0,20,0.95); border-top: 4px solid #ff00ff;
      display: flex; align-items: center; gap: 14px; padding: 0 15px;
      overflow-x: auto; z-index: 100; backdrop-filter: blur(6px);
    }
    #monster-bar img {
      width: 72px; height: 72px; border-radius: 14px; object-fit: contain;
      filter: grayscale(100%) brightness(0.5); border: 3px solid #333;
      transition: all 0.4s ease; flex-shrink: 0; background: #111;
    }
    #monster-bar img.found {
      filter: grayscale(0%) brightness(1.4);
      border-color: #ff00ff; box-shadow: 0 0 20px #ff00ff;
      transform: scale(1.12);
    }

    #win-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.98); display: none; flex-direction: column;
      justify-content: center; align-items: center; color: white; text-align: center; z-index: 1000;
    }
    #win-screen h1 { font-size: 4.5em; margin: 20px; text-shadow: 0 0 25px gold; font-family: 'Creepster', cursive; }
    #win-screen video { max-width: 90%; max-height: 60%; border-radius: 18px; box-shadow: 0 0 50px gold; }
    .menu-btn {
      margin-top: 35px; padding: 20px 60px; font-size: 1.8em; border: 4px solid #ffd700;
      background: linear-gradient(45deg, #6600cc, #ff00ff); color: white; cursor: pointer;
      border-radius: 60px; font-weight: bold; box-shadow: 0 0 30px rgba(255,215,0,0.7);
      transition: all 0.3s;
    }
    .menu-btn:hover { transform: scale(1.12); background: linear-gradient(45deg, #ff00ff, #ffd700); }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
  <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
</head>
<body>

  <div id="panorama"></div>
  <div id="timer">00:00</div>

  <div id="counter">
    <img src="https://cdn-icons-png.flaticon.com/32/3566/3566633.png" alt="Found">
    <span id="found">0</span> / <span id="total">8</span>
  </div>

  <div id="monster-bar"></div>

  <div id="win-screen">
    <h1>Level 3 Complete!</h1>
    <p>The Gallery is clear!</p>
    <p style="margin-top: 10px; color: #ffd700; font-style: italic;">(More levels to come...)</p>
    
    <video autoplay loop muted playsinline>
      <source src="congrats.mp4" type="video/mp4">
      <img src="congrats.gif" alt="Victory">
    </video>
    <button class="menu-btn" onclick="window.location.href='index.html'">Main Menu</button>
  </div>

  <script>
    const TOTAL_CLUES = 8;
    let foundCount = 0;
    const found = new Set();
    let seconds = 0;
    let timerInterval;

    /* ART GALLERY POSITIONS */
    const clues = [
      { id: 1, src: "clue1.png", pitch: -60, yaw: 0, scale: 0.9, cssClass: "clue-hotspot" },
      { id: 2, src: "clue2.png", pitch: -5, yaw: 145, scale: 0.8, cssClass: "clue-hotspot" },
      { id: 3, src: "clue3.png", pitch: 5, yaw: -45, scale: 0.8, cssClass: "clue-hotspot" },
      { id: 4, src: "clue4.png", pitch: -10, yaw: -15, scale: 0.7, cssClass: "clue-hotspot" },
      { id: 5, src: "clue5.png", pitch: -5, yaw: -110, scale: 0.7, cssClass: "clue-hotspot" },
      { id: 6, src: "clue6.png", pitch: 45, yaw: -80, scale: 0.9, cssClass: "clue-hotspot" },
      // HARD ONES
      { id: 7, src: "clue7.png", pitch: 65, yaw: 90, scale: 0.4, cssClass: "clue-hotspot hard" },
      { id: 8, src: "clue8.png", pitch: -25, yaw: -65, scale: 0.35, cssClass: "clue-hotspot expert" }
    ];

    function startTimer() {
      timerInterval = setInterval(() => {
        seconds++;
        const m = String(Math.floor(seconds / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        document.getElementById('timer').textContent = `${m}:${s}`;
      }, 1000);
    }

    function buildMonsterBar() {
      const bar = document.getElementById('monster-bar');
      bar.innerHTML = ''; 
      clues.forEach(clue => {
        const img = document.createElement('img');
        img.src = clue.src;
        img.dataset.id = clue.id;
        img.alt = `Monster ${clue.id}`;
        bar.appendChild(img);
      });
    }

    function updateUI() {
      document.getElementById('found').textContent = foundCount;
      document.querySelectorAll('#monster-bar img').forEach(img => {
        if (found.has(Number(img.dataset.id))) img.classList.add('found');
      });
      if (foundCount === TOTAL_CLUES) {
        clearInterval(timerInterval);
        setTimeout(() => document.getElementById('win-screen').style.display = 'flex', 1200);
      }
    }

    function createHotspot(clue) {
      return {
        pitch: clue.pitch, yaw: clue.yaw, type: "info", cssClass: clue.cssClass,
        createTooltipFunc: hotSpotDiv => {
          const img = document.createElement('img');
          img.src = clue.src;
          img.style.width = '100%'; img.style.height = '100%'; img.style.objectFit = 'contain';
          img.style.transform = `scale(${clue.scale})`;
          img.style.transition = 'all 0.3s ease'; img.style.cursor = 'pointer';
          hotSpotDiv.appendChild(img);

          hotSpotDiv.onclick = () => {
            if (found.has(clue.id)) return;
            found.add(clue.id);
            foundCount++;
            updateUI();
            img.style.transform = `scale(${clue.scale * 1.5})`;
            img.style.filter = 'brightness(1.6)';
            setTimeout(() => {
              img.style.opacity = '0.3';
              img.style.filter = 'grayscale(100%)';
            }, 300);
          };
        }
      };
    }

    const style = document.createElement('style');
    style.textContent = `
      .clue-hotspot, .clue-hotspot.hard, .clue-hotspot.expert { width: 60px; height: 60px; }
      .clue-hotspot.hard { width: 45px; height: 45px; }
      .clue-hotspot.expert { width: 40px; height: 40px; }
      .pnlm-hotspot-base { background: transparent !important; box-shadow: none !important; border: none !important; }
    `;
    document.head.appendChild(style);

    window.addEventListener('load', () => {
      buildMonsterBar();
      startTimer();
      document.getElementById('total').textContent = TOTAL_CLUES;

      pannellum.viewer('panorama', {
        type: "equirectangular",
        panorama: "360img3.jpg",
        autoLoad: true,
        autoRotate: -2.0,
        autoRotateInactivityDelay: 3000,
        showControls: true,
        hotSpots: clues.map(createHotspot)
      });
    });
  </script>
</body>
</html>
